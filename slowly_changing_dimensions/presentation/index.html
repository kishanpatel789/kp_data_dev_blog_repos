<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Slowly Changing Dimensions</title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/kpdatadev.css" />

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/default.css" />

    <link rel="icon" type="image/svg+xml" href="images/Favicon.svg" />

    <style>
section table {
  font-size: 1.5rem;
  margin: 0 auto; 
}

section table td, section table th {
  padding: 0.3em 0.6em;
}

.fragment.highlight-cell {
  background-color: transparent;
}

.fragment.highlight-cell.visible {
  background-color: #fff3cd;
}

.highlight-cell {
  background-color: #fff3cd;
}

.overflow-x-auto {
  overflow-x: auto;
}
    </style>

  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <section></section>
            
          <section>
            <h1 style="text-align: left;">
              <strong style="color: #c2ae45;">S</strong>lowly<br>
              <strong style="color: #c2ae45;">C</strong>hanging<br>
              <strong style="color: #c2ae45;">D</strong>imensions
            </h1>
          </section>


          <section>
            <code>fct_encounter</code>
            <div class="overflow-x-auto">
              <table>
                <thead>
                  <tr>
                    <th>id</th>
                    <th>patient_id</th>
                    <th>encounter_date</th>
                    <th>diagnosis_code</th>
                    <th>treatment_code</th>
                    <th style="text-align: right;">total_cost</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>E10001</td>
                    <td>P001</td>
                    <td>1997-05-15</td>
                    <td>SM-101</td>
                    <td>SP-17</td>
                    <td style="text-align: right;">1200</td>
                  </tr>
                  <tr>
                    <td>E10002</td>
                    <td>P001</td>
                    <td>1996-02-12</td>
                    <td>SM-205</td>
                    <td>SP-03</td>
                    <td style="text-align: right;">300</td>
                  </tr>
                  <tr>
                    <td>E10003</td>
                    <td>P002</td>
                    <td>1995-07-21</td>
                    <td>SM-330</td>
                    <td>SP-21</td>
                    <td style="text-align: right;">450</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <section data-markdown>
            <textarea data-template>

`dim_patient`

| id   | first_name | last_name | date_of_birth | address                         |
| ---  | ---        | ---       | ---           | ---                             |
| P001 | Harry      | Potter    | 1980-07-31    | 4 Privet Drive, Little Whinging |
| P002 | Ron        | Weasley   | 1980-03-01    | The Burrow, Ottery St Catchpole |
| P003 | Hermione   | Granger   | 1979-09-19    | 34 Tennyson Road, London        |
            </textarea>
          </section>


        </section>



        <section>

          <section>
            <h2>SCD Type 1</h2>
          </section>

          <section>
            <h5><code>dim_patient</code></h5>

            <div
                style="display: flex; flex-direction: row; justify-content: space-between; gap: 2rem;"
                >
                <div style="flex: 1">
                  <h6>Before</h6>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                      </tr>
                      <tr>
                        <td>P002</td>
                        <td>Ron</td>
                        <td>The Burrow</td>
                      </tr>
                      <tr>
                        <td>P003</td>
                        <td>Hermione</td>
                        <td>34 Tennyson Road</td>
                      </tr>
                    </tbody>
                  </table>

                </div>


                <div style="flex: 1" class="fragment">
                  <h6>After</h6>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td class="highlight-cell">12 Grimmauld Place</td>
                      </tr>
                      <tr>
                        <td>P002</td>
                        <td>Ron</td>
                        <td>The Burrow</td>
                      </tr>
                      <tr>
                        <td>P003</td>
                        <td>Hermione</td>
                        <td>34 Tennyson Road</td>
                      </tr>
                    </tbody>
                  </table>

                </div>
            </div>
          </section>

        </section>


        <section>

          <section>
            <h2>SCD Type 2</h2>
          </section>

          <section>
            <h5><code>dim_patient</code></h5>

            <div
                style="display: flex; flex-direction: row; justify-content: space-between; gap: 2rem;"
                >
                <div style="flex: 1">
                  <h6>Before</h6>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                      </tr>
                      <tr>
                        <td>P002</td>
                        <td>Ron</td>
                        <td>The Burrow</td>
                      </tr>
                      <tr>
                        <td>P003</td>
                        <td>Hermione</td>
                        <td>34 Tennyson Road</td>
                      </tr>
                    </tbody>
                  </table>

                </div>


                <div style="flex: 1" class="fragment">
                  <h6>After</h6>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                      </tr>
                      <tr class="highlight-cell">
                        <td>P001</td>
                        <td>Harry</td>
                        <td>12 Grimmauld Place</td>
                      </tr>
                      <tr>
                        <td>P002</td>
                        <td>Ron</td>
                        <td>The Burrow</td>
                      </tr>
                      <tr>
                        <td>P003</td>
                        <td>Hermione</td>
                        <td>34 Tennyson Road</td>
                      </tr>
                    </tbody>
                  </table>

                </div>
            </div>
          </section>


          <section>
            <h5><code>dim_patient</code> (Type 2)</h5>
            <table>
              <thead>
                <tr>
                  <th>id</th>
                  <th>start_date</th>
                  <th>end_date</th>
                  <th>first_name</th>
                  <th>address</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>P001</td>
                  <td class="highlight-cell">1981-10-31</td>
                  <td class="highlight-cell">1996-06-30</td>
                  <td>Harry</td>
                  <td class="highlight-cell">4 Privet Drive</td>
                </tr>
                <tr>
                  <td>P001</td>
                  <td class="highlight-cell">1996-07-01</td>
                  <td class="highlight-cell">9999-12-31</td>
                  <td>Harry</td>
                  <td class="highlight-cell">12 Grimmauld Place</td>
                </tr>
                <tr>
                  <td>P002</td>
                  <td>1990-01-01</td>
                  <td>9999-12-31</td>
                  <td>Ron</td>
                  <td>The Burrow</td>
                </tr>
                <tr>
                  <td>P003</td>
                  <td>1992-07-01</td>
                  <td>9999-12-31</td>
                  <td>Hermione</td>
                  <td>34 Tennyson Road</td>
                </tr>
              </tbody>
            </table>

          </section>

          <section>
            <pre><code data-trim class="language-sql">
SELECT *
FROM fct_encounter e
JOIN dim_patient p
    ON e.patient_id = p.id
    AND e.encounter_date 
        BETWEEN p.start_date AND p.end_date;
            </code></pre>

          </section>

          <section>
            <h4>Other ways to indicate active record</h4>

            <div
                style="display: flex; flex-direction: column; justify-content: space-between; gap: 2rem;"
                >
                <table class="fragment">
                  <thead>
                    <tr>
                      <th>id</th>
                      <th>effective_date</th>
                      <th class="highlight-cell">is_active</th>
                      <th>first_name</th>
                      <th>address</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>P001</td>
                      <td>1981-10-31</td>
                      <td class="highlight-cell">FALSE</td>
                      <td>Harry</td>
                      <td>4 Privet Drive</td>
                    </tr>
                    <tr>
                      <td>P001</td>
                      <td>1996-07-01</td>
                      <td class="highlight-cell">TRUE</td>
                      <td>Harry</td>
                      <td>12 Grimmauld Place</td>
                    </tr>
                  </tbody>
                </table>

                <table class="fragment">
                  <thead>
                    <tr>
                      <th>id</th>
                      <th>effective_date</th>
                      <th class="highlight-cell">version</th>
                      <th>first_name</th>
                      <th>address</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>P001</td>
                      <td>1981-10-31</td>
                      <td class="highlight-cell" style="text-align: right;">1</td>
                      <td>Harry</td>
                      <td>4 Privet Drive</td>
                    </tr>
                    <tr>
                      <td>P001</td>
                      <td>1996-07-01</td>
                      <td class="highlight-cell" style="text-align: right;">2</td>
                      <td>Harry</td>
                      <td>12 Grimmauld Place</td>
                    </tr>
                  </tbody>
                </table>
            </div>

          </section>

        </section>

        <section>
          <section>
            <h2>SCD Type 3</h2>
          </section>

          <section>
            <div
                style="display: flex; flex-direction: column; justify-content: space-between; gap: 2rem;"
                >
                <div style="flex: 1">
                  <h6>Before</h6>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                      </tr>
                    </tbody>
                  </table>

                </div>


                <div style="flex: 1" class="fragment">
                  <h6>After</h6>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th class="highlight-cell">original_address</th>
                        <th class="highlight-cell">current_address</th>
                        <th class="highlight-cell">effective_date</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                        <td class="highlight-cell">12 Grimmauld Place</td>
                        <td class="highlight-cell">1996-07-01</td>
                      </tr>
                    </tbody>
                  </table>

                </div>
            </div>
          </section>


        </section>


        <section>
          <section>
            <h2>SCD Type 4</h2>
          </section>

          <section>
            <h6>Before</h6>
            <div
                style="display: flex; flex-direction: column; justify-content: space-between; gap: 2rem;"
                >
                <div style="flex: 1">
                  <code style="font-size: 0.6em;">dim_patient</code>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                      </tr>
                    </tbody>
                  </table>

                </div>


                <div style="flex: 1" class="fragment">
                  <code style="font-size: 0.6em;">dim_patient_hist</code>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                        <th>effective_date</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                        <td>1981-10-31</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            </div>
          </section>


          <section>
            <h6>After</h6>
            <div
                style="display: flex; flex-direction: column; justify-content: space-between; gap: 2rem;"
                >
                <div style="flex: 1">
                  <code style="font-size: 0.6em;">dim_patient</code>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td class="highlight-cell">12 Grimmauld Place</td>
                      </tr>
                    </tbody>
                  </table>

                </div>


                <div style="flex: 1">
                  <code style="font-size: 0.6em;">dim_patient_hist</code>
                  <table>
                    <thead>
                      <tr>
                        <th>id</th>
                        <th>first_name</th>
                        <th>address</th>
                        <th>effective_date</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P001</td>
                        <td>Harry</td>
                        <td>4 Privet Drive</td>
                        <td>1981-10-31</td>
                      </tr>
                      <tr class="highlight-cell">
                        <td>P001</td>
                        <td>Harry</td>
                        <td>12 Grimmauld Place</td>
                        <td>1996-07-01</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            </div>
          </section>


        </section>

        <section>
          <h3>Slowly Changing Dimensions</h3>
          <ul style="font-size: 0.7em;">
            <li class="fragment"><strong>Type 1</strong>: New record replaces original record. Old record is lost.</li>
            <li class="fragment"><strong>Type 2</strong>: New record added to table. Other columns identify when records are in effect.</li>
            <li class="fragment"><strong>Type 3</strong>: Original record is modified. Extra column gives old value.</li>
            <li class="fragment"><strong>Type 4</strong>: Current dimension table is updated. New record is added to historical table.</li>
          </ul>
        </section>




        <section data-background-color="#293c47" style="text-align: left">
          <div style="margin-bottom: 1em">
            <p>
              Ask me questions about:<br />Data engineering,
              <strong>learning Python</strong>, anything else
            </p>
          </div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <p>
              <strong>Kishan Patel</strong><br />
              <small
                >Data Engineering Trainer<br />
                <strong>info@kpdata.dev</strong></small
              >
            </p>
            <img
              src="images/LightLogo.svg"
              alt="KP Data Dev logo"
              style="height: 100px"
            />
          </div>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        progress: false,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
      }); 
    </script>
  </body>
</html>
